/*!
 * The MIT License
 * 
 * Copyright (c) 2011-2013 h5 Authors. All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
(function(p){if(p.h5&&p.$){return;}var d,e=Array.prototype,g=Object.prototype,n=e.slice,h=n,b=g.toString,w=p.document,t=1,f;if(typeof p.console==="undefined"){p.console=(function(){var x=p.opera?p.opera.postError:function(){};return{log:x};})();}function o(x){if(Object.create){return Object.create(x);}function y(){}y.prototype=x;return new y();}function c(x){return b.call(x).slice(8,-1);}function m(y,x){return b.call(y).slice(8,-1)===x;}function l(x,z){if(x.hasOwnProperty){return x.hasOwnProperty(z);}else{var y=x[z];return typeof y!=="undefined"&&x.constructor.prototype[z]!==y;}}function a(x){return b.call(x)==="[object Function]";}function k(x){return b.call(x)==="[object Array]";}function j(D,z){var y,A,x=this.length,B=D||0,C=z||x;if(k(this)){y=h.call(this,B,C);}else{if(C<0){C=x-C;}y=[];for(A=B;A<C;A++){y[y.length]=this[A];}}return y;}function r(){return t++;}function q(x){return x.replace(/(^\s+)|\s+$/g,"");}(function(){try{n.call(w.getElementsByTagName("html"));}catch(x){console.log("Array slice does not work on array-like objects, using custom slice");n=j;}})();function s(x,C,B){var A=Object(x),z=x.forEach,y;if(z&&a(z)){x.forEach(C,B);}else{for(y in A){C.call(B,A[y],y,x);}}}function i(x,C,B){var A=Object(x),y=x.filter,z;if(y&&a(y)){return A.filter(C,B);}else{z=[];s(x,function(F,E,D){if(C.call(B,F,E,D)){z[z.length]=F;}});return z;}}function v(x,A,z){var y=[];s(x,function(E,C,B){if(typeof E!=="undefined"){var D=A.call(z,E);if(D!==null&&typeof D!=="undefined"){y[y.length]=D;}}});return y;}function u(){var y=arguments[0],x=n.call(arguments,1);s(x,function(A){for(var z in A){y[z]=A[z];}});return y;}f=(function(){var I=/^\s*<(\w+)[^>]*>/,E=!!window.ActiveXObject,J=w.createElement("table"),A=w.createElement("tbody"),C=w.createElement("tr"),x=w.createElement("div"),F=!!w.querySelectorAll,K=p.selectorEngine,z={"*":x,tbody:J,tfoot:J,tr:A,td:C,th:C},D;function B(O,P){var Q,M,N,L;if(!P){M=I.exec(O);P=M?M[1]:null;}Q=z[P]||x;if(E){L=Q.tagName.toLowerCase();if(L==="tbody"||L==="table"||L==="thead"){return y("table",O,true);}}Q.innerHTML=""+O;N=Q.childNodes;return n.call(N);}function G(O,P){var M={e:[],s:""},N,L;if(!O){return M;}else{if(m(O,"String")){if((N=I.exec(O))!==null){M.e=B(O,N[1]);}else{if(F){L=P.querySelectorAll(O);}else{if(K){L=K(O,P);}else{throw new Error("No selector engine found. Set custom engine via global selectorEngine property");}}M.e=n.call(L);M.s=O;}}else{if(O.elements){M.e=O.elements;M.s=O.selector;}else{if(O.nodeName){M.e=[O];}else{if(O.length){M.e=n.call(O);}else{if(O===p){M.e=[O];}}}}}}return M;}function y(O,L,N){var M;L+="";x.innerHTML=["<",O,">",L,"</",O,">"].join("");M=N?x.firstChild.firstChild.childNodes:x.firstChild.childNodes;return M;}D={get:function(L){return this.elements[L];},count:function(){return this.elements.length;},find:function(L){var M=this.elements;return M.length===0?H(L):H(L,M[0]);},forEach:function(M,L){s(this.elements.slice(0),M,L||p);return this;},filter:function(M,L){return i(this.elements.slice(0),M,L||p);}};function H(O,N){N=N?N.elements?N.elements[0]:N:w;var M=G(O,N),L=o(D);L.elements=M.e;L.selector=M.s;L.context=N;return L;}H.forEach=s;H.filter=i;H.map=v;H.isArray=k;H.getTypeOf=c;H.isTypeOf=m;H.slice=function(L,N,M){return n.call(L,N,M);};H.trim=String.prototype.trim?function(L){return L.trim();}:function(L){return q(L);};H.extend=u;H.getFragments=B;H.uuid=r;H.createObject=o;H.extension=function(){var O=arguments[0],N=arguments[1],L=O,M=c(O);if(M==="String"){if(D[L]){console.log("Warning! Extension "+L+" is already defined");}if(!N){console.log("Extension value not provided for "+L);return;}D[L]=N;}else{if(M==="Object"){s(O,function(Q,P){if(a(Q)){H.extension(P,Q);}});}}};return H;})();p.h5=p.$=f;})(this);(function(d){var f=d.forEach,e=d.isTypeOf,h=d.extend,n=function(){},g={},c={setup:n,destroy:n,defaultAction:n},a=[],j=false;function l(s,r){var q,t=r||{},u,p=t.bubbles===false?false:true,o=t.cancelable===false?false:true;q=document.createEvent("Events");if(e(r,"Object")){for(u in t){if(u!=="bubbles"&&u!=="cancelable"){q[u]=t[u];}}}else{q.data=r;}q.initEvent(s,p,o);return q;}function i(){if(j){return;}j=true;f(a,function(o){o.call(window);});a=null;}function b(r,o){var q=g[r],p,s;if(!q){return;}s=q.count;if(!s){p=q.definition;p.setup();}q.count+=o.length;}function k(r,o){var q=g[r],p,s;if(!q||!q.count){return;}q.count-=o.length;if(!q.count){p=q.definition;p.destroy();}}(function m(){var o=function(){document.removeEventListener("DOMContentLoaded",o,false);i();};if(document.addEventListener){document.addEventListener("DOMContentLoaded",o,false);}})();d.extension({on:function(p,q){var o=this.elements;b(p,o);f(o,function(r){r.addEventListener(p,q,false);});return this;},un:function(q,r,p){var o=this.elements;k(q,o);f(o,function(s){s.removeEventListener(q,r,p||false);});return this;},capture:function(p,q){var o=this.elements;b(p,o);f(o,function(r){r.addEventListener(p,q,true);});return this;},dispatch:function(o,p){f(this.elements,function(r){var q=l(o,p);return r.dispatchEvent(q);});return this;}});d.ready=function(o){if(j){o.call(window);}else{a.push(o);}};d.defineEvent=function(o){var r,q,p;p=o.type;if(!p){d.ready(function(){o.setup();});d(document).on("unload",function(){o.destroy();});return;}r=g[p];if(r){q=r.definition;q.destroy();console.log("Event "+p+" is already defined, overwriting!");}else{g[p]={type:p,count:0,definition:h({},c,o)};}};})(h5);(function(j){var c,i=window.getComputedStyle,C=j.getFragments,r=j.slice,w=j.forEach,p=j.isTypeOf,l=j.isArray,b=j.getTypeOf,t=j.trim,x={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},y={};function k(D){var E=D.firstChild;while(E){D.removeChild(E);E=D.firstChild;}return D;}function d(E,D){if(D){return k(E);}try{E.innerHTML="";}catch(F){return k(E);}return E;}function q(E){if(!E){return false;}var D=b(E);return D==="NodeList"||D==="HTMLCollection"||(E.item&&(E.length!==c));}function s(D){return y[D]||(y[D]=new RegExp("(^|\\s+)"+D+"(?:\\s+|$)"));}function f(F,E,K){var J=F.nodeName.toLowerCase(),D=b(E),H=(J==="table"||J==="tbody"),I,G;if(D==="String"||D==="Number"){G=C(E);}else{if(E.nodeName){G=[E];}else{if(E.elements){G=E.elements;}else{if(l(E)||q(E)){G=E;}else{G=C(E);}}}}I=H?(F.getElementsByTagName("tbody")[0]||F):F;K(I,r(G));}function v(E,D){f(E,D,function(F,G){w(G,function(H){F.appendChild(H);});});}function e(E,D){f(E,D,function(J,I){var H,F,G=E.parentNode;for(F=I.length-1;F>=0;F--){H=I[F];G.insertBefore(H,J);}});}function B(E,D){f(E,D,function(J,H){var I,G,F;for(F=H.length-1;F>=0;F--){I=J.firstChild;G=H[F];if(I){J.insertBefore(G,I);}else{J.appendChild(G);}}});}function z(E,D){f(E,D,function(F,G){F=d(F);v(F,G);});}function a(E,D){return s(D).test(E.className);}function m(F,D){var E=F.classList;if(!E||!D){return false;}E.add(D);return true;}function o(F,D){var E=F.classList;if(!E||!D){return false;}E.remove(D);return true;}function A(F,H,G){var E=arguments.length,D=F.datamap||(F.datamap={});if(E===1){return D;}else{if(E===2){return D[H];}else{D[H]=G;return null;}}}function h(E,F){var D;if(i){D=i(E,null);}else{D=E.currentStyle;}return D[F];}function n(E){var F={left:E.offsetLeft,top:E.offsetTop,width:E.offsetWidth,height:E.offsetHeight},D=E.offsetParent;while(D){F.left+=D.offsetLeft;F.top+=D.offsetTop;D=D.offsetParent;}return F;}function g(F,E){var D=F.style;w(E,function(H,G){D[G]=H;});}function u(E,D){w(D,function(H,F){var G=x[F],I=G||F;if(G){E[I]=H;}else{E.setAttribute(F,H);}});}j.extension({html:function(D){var G=this.elements,E,F;if(arguments.length===0){E=[];w(G,function(H){E[E.length]=H.innerHTML;});return E.join("");}D=typeof D==="undefined"||D===null?"":D;F=p(D,"String");w(G,function(H){if(F){try{H.innerHTML=D;}catch(I){z(H,D);}}else{z(H,D);}});return this;},attr:function(E,I){var H=x[E],J=H||E,G=this.elements,D,F=typeof E;if(!G.length){return I?this:null;}if(arguments.length===1){if(F==="string"){if(H){return G[0][J];}return G[0].getAttribute(E);}else{w(G,function(K){u(K,J);});return this;}}else{if(H){w(G,function(K){K[J]=I;});}else{w(G,function(K){K.setAttribute(E,I);});}return this;}},val:function(I){var H,E,K,F,G,J,D=this.elements,L;if(!D.length){return I?this:null;}if(arguments.length===1){w(D,function(M){H=M.nodeName.toLowerCase();if(H==="select"){E=j("option",M).elements;K=p(I,"Array")?I:[I];M.selectedIndex=-1;w(K,function(O){try{w(E,function(Q,P){F=Q.value||Q.innerHTML;if(F===O){Q.selected="selected";throw"Break";}return null;});}catch(N){}});}else{M.value=I;}});return this;}else{G=D[0];H=G.nodeName.toLowerCase();if(H==="select"){J=[];E=j("option",G).elements;w(E,function(M){if(M.selected){F=M.value||M.innerHTML;J[J.length]=F;}});L=J.length;return L===0?"":L===1?J[0]:J;}else{return G.value;}}},data:function(E,G){var D=arguments.length,F=this.elements;if(F.length===0){return null;}if(D===1){return A(F[0],E);}else{w(F,function(H){A(H,E,G);});}return this;},append:function(D){var E=this.elements;if(!D||!E.length){return this;}v(E[0],D);return this;},prepend:function(D){var E=this.elements;if(!D||!E.length){return this;}B(E[0],D);return this;},before:function(E){var D=this.elements;if(!E||!D.length){return this;}e(D[0],E);return this;},remove:function(){var E,D=this.elements;if(!arguments.length){w(D,function(G){var F=G.parentNode;F.removeChild(G);});this.elements=[];}else{if(D.length){E=arguments[0];w(D,function(F){w(j(E,F),function(G){var H=G.parentNode;return H?H.removeChild(G):null;});});}}return this;},hasClass:function(D){var E=this.elements;return E.length&&a(E[0],D);},addClass:function(D){var E=this.elements;w(E,function(F){if(!a(F,D)&&!m(F,D)){F.className+=" "+D;}});return this;},removeClass:function(D){w(this.elements,function(F){var E;if(a(F,D)&&!o(F,D)){F.className=t(F.className.replace(s(D),"$1"));}});return this;},getStyle:function(E){var D=this.elements;return D.length===0?"":h(D[0],E);},setStyle:function(D){w(this.elements,function(F){var E=F.style;w(D,function(H,G){E[G]=H;});});return this;},css:function(F,E){var D;if(b(F)==="Object"){D=[];w(F,function(H,G){D[D.length]=G+":"+H;});D=D.join(";");}else{D=F+":"+E;}w(this.elements,function(H){var G=H.style,I=G.cssText;if(I){G.cssText=I+";"+D;}else{G.cssText=D;}});},offsets:function(){var D=this.elements;return D.length===0?null:n(D[0]);}});})(h5);(function(g,a){var e=a,f={};function b(){f.id=f.x=f.y=f.moved=f.target=e;}function c(k,m,j,l){var i=k-j,h=m-l;return Math.abs(i)>30||Math.abs(h)>30;}function d(l){var i=l.type,m,k=l.touches,h=l.changedTouches,j=l.target;switch(i){case"touchstart":if(k.length!==1){return;}m=k[0];f.id=m.identifier;f.x=m.pageX;f.y=m.pageY;f.target=j;break;case"touchmove":m=h[0];if(!f.moved&&m.identifier===f.id){f.moved=c(f.x,f.y,m.pageX,m.pageY);}break;case"touchend":if(h.length===0||f.moved){b();return;}m=h[0];if(m.identifier===f.id&&!c(f.x,f.y,m.pageX,m.pageY)&&f.target===j){g(j).dispatch("tap");}break;case"touchcancel":b();break;}}g.defineEvent({type:"tap",setup:function(){g(document).on("touchstart",d).on("touchmove",d).on("touchend",d).on("touchcancel",d);},destroy:function(){g(document).un("touchstart",d).un("touchmove",d).un("touchend",d).un("touchcancel",d);}});})(h5);(function(c){var b={};function a(g){var e=Date.now(),d=e-(b.last||e),f=g.target;if(d>0&&d<300&&b.target===f){c(f).dispatch("dbltap");b.last=b.target=null;}else{b.last=e;b.target=g.target;}}c.defineEvent({type:"dbltap",setup:function(){c(document).on("tap",a);},destroy:function(){c(document).un("tap",a);}});})(h5);(function(g,a){var e=a,f={},h;function c(l,n,k,m){var j=l-k,i=n-m;return Math.abs(j)>30||Math.abs(i)>30;}function b(){f.moved=f.x=f.y=e;}function d(k){var i=k.type,j=k.target;switch(i){case"touchstart":if(k.touches.length!==1){return;}f.x=k.pageX;f.y=k.pageY;h=setTimeout(function(){if(!f.moved){g(j).dispatch("taphold");}},700);break;case"touchmove":if(!f.moved){f.moved=c(f.x,f.y,k.pageX,k.pageY);}break;case"touchend":case"touchcancel":default:clearTimeout(h);b();break;}}g.defineEvent({type:"taphold",setup:function(){g(document).on("touchstart",d).on("touchmove",d).on("touchend",d).on("touchcancel",d);},destroy:function(){g(document).un("touchstart",d).un("touchmove",d).un("touchend",d).un("touchcancel",d);}});})(h5);(function(f,a){var d=a,e={};function g(l,n,k,m){var j=l-k,i=n-m,o,h;if((o=Math.abs(j))<30&(h=Math.abs(i))<30){return null;}return{x:j,y:i,dir:o>=h?(j<0?"left":"right"):(i<0?"up":"down")};}function b(){e.id=e.x=e.y=e.movement=d;}function c(n){var j=n.type,l=n.touches,o,k,h,i;switch(j){case"touchstart":l=n.touches;if(l.length>1){return;}o=l[0];e.id=o.identifier;e.x=o.pageX;e.y=o.pageY;break;case"touchmove":l=n.changedTouches;o=l[0];if(o.identifier===e.id&&n.touches.length===1){e.movement=g(o.pageX,o.pageY,e.x,e.y);}break;case"touchend":l=n.changedTouches;o=l[0];if(e.id===o.identifier&&(h=e.movement)){i={movement:h};f(n.target).dispatch("swipe",i);b();}break;default:b();break;}}f.defineEvent({type:"swipe",setup:function(){f(document).on("touchstart",c).on("touchmove",c).on("touchend",c).on("touchcancel",c);},destroy:function(){f(document).un("touchstart",c).un("touchmove",c).un("touchend",c).un("touchcancel",c);}});})(h5);(function(d){var g=d.forEach,f=d.isTypeOf,e=d.getTypeOf,m=d.slice,o=function(){},j=d.extend,b=window.XMLHttpRequest,l=d(document),a=d.uuid,i={json:"application/json",xml:"application/xml",html:"text/html",text:"text/plain"},c={xml:function(s){var r=s.responseXML,q=r.documentElement;if(q&&q.nodeName==="parseerror"){throw new Error("parseerror");}return r;},json:function(q){return JSON.parse(q.responseText);},text:function(q){return q.responseText;}},p={url:window.location.href,method:"GET",contentType:"application/x-www-form-urlencoded",async:true,data:null,dataType:"text",headers:{},success:o,error:o};function h(q,r){try{l.dispatch(q,r);}catch(s){console.log("Error dispatching ajax event: "+s.message);}}function k(r,v){var t="_jsonp"+a(),q,u=r.replace("callback=?","callback="+t).replace("jsonp=?","jsonp="+t),s=function(){h("ajaxend",r);v.apply(null,m(arguments));};window[t]=s;h("ajaxstart",r);q=d(document.createElement("script")).attr({src:u,type:"text/javascript"});d("head").append(q);}function n(r){var t,s=j({},p,r),q=s.url,x=s.dataType,v=s.data,u=i[x]||"text/plain";h("ajaxstart",q);t=b?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");if(s.username){t.open(s.method,q,s.async,s.username,s.password);}else{t.open(s.method,q,s.async);}g(s.headers,function(z,y){t.setRequestHeader(y,z);});t.setRequestHeader("X-Requested-With","XMLHttpRequest");t.onreadystatechange=function(){var D=t.readyState,B,A,C,z;if(D===4){B=t.status;if((B>=200&&B<300)||B===0){h("ajaxsuccess",q);z=c[x]||c.text;try{C=z(t);}catch(y){A=y;}if(A){s.error(A,t);}else{s.success(C,t);}}else{h("ajaxerror",{data:{url:q,status:B}});s.error(B,t);}h("ajaxend",q);}};if(v){t.setRequestHeader("Content-Type",s.contentType);t.setRequestHeader("Accept",u);}if(f(v,"Object")){try{v=JSON.stringify(v,null,"");t.setRequestHeader("Content-Type",u);}catch(w){}}t.send(v);}d.xhr=n;d.jsonp=k;d.ajax=n;d.get=function(r,s,q){n({url:r,success:s,error:q});};d.post=function(q,s,u,t){var r={url:q,data:s,success:u};if(t){r.dataType=t;}n(r);};d.getJson=function(r,t,q){var s={url:r,success:t,dataType:"json"};if(e(q)==="Function"){s.error=q;}n(s);};d.extension("load",function(s,q,v){var r=this.elements,t=this,u=q,w=v;if(typeof u==="function"){w=q;u=null;}if(r.length>0){n({url:s,success:function(y,x){t.html(u?d(document.createElement("div")).html(y).find(u):y);if(w){w(y,x);}}});}return this;});})(h5);